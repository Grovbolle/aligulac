{% extends "index.html" %}

{% comment %}
War clocks
{% endcomment %}

{% load ratings_extras %}

{% block title %}Clocks{% endblock %}

{% block content %}

<script>
// Generated by CoffeeScript 1.7.1
var today, toggle_more;

today = new Date;

toggle_more = function(e) {
  if ($(e).next().is(":visible")) {
    $(e).next().hide();
    return $(e).children().first().text("→");
  } else {
    $(e).next().show();
    return $(e).children().first().text("↘");
  }
};

$(document).ready(function() {
  return $(".clock").each(function(i, e) {
    var d, days, diff, output, years;
    d = new Date($(e).text());
    diff = Math.floor((today - d) / 1000);
    years = Math.floor(diff / (60 * 60 * 24 * 365));
    diff -= years * (60 * 60 * 24 * 365);
    days = Math.floor(diff / (60 * 60 * 24));
    output = "<div class='clock-number'> " + days + "</div> day" + (days === 1 ? "" : "s");
    if (years > 0) {
      output = ("<div class='clock-number'> " + years + "</div> year" + (years === 1 ? "" : "s")) + output;
    }
    return $(e).html(output);
  });
});

</script>

<table class="clocks">
  {% for clock in clocks %}
  <tr onclick="toggle_more(this);" class="clock-more-button">
    <td style="width: 25px;">→</td>
    <td{% if clock.alt_desc %} title="{{ clock.alt_desc }}"{% endif %}>{{ clock.desc }}</td>
    <td class="clock">{{ clock.date }}</td>
  </tr>
  {% if clock.type == "match" %}
  <tr style="display:none;">
    <td></td>
    <td colspan="2">
      <table class="clock-results-table results">
        {% include "matchlist.html" with lm_list=clock.extra lm_adm=0 lm_header="partial"%}
      </table>
    </td>
  </tr>
  {% endif %}
  {% if clock.type == "event_winner" %}
  <tr style="display:none;">
    <td></td>
    <td colspan="2">
      <table class="clock-event-table">
        <thead><tr class="header"><th>Date</th><th>Event</th><th></th><th></th></tr></thead>
        <tbody>
        {% for e, earn in clock.extra %}
        <tr class="nonheader {% cycle 'row2' 'row1' %}">
          <td>{{ e.latest }}</td>
          <td>{{ e|event }}</td>
          <td>{{ earn.0.player|player }}</td>
          <td>{{ earn.0.earnings|add_sep_and_cur:"USD" }}</td>
        </tr>
        <tr class="nonheader {% cycle 'row2' 'row1' %}">
          <td></td>
          <td></td>
          <td>{{ earn.1.player|player }}</td>
          <td>{{ earn.1.earnings|add_sep_and_cur:"USD" }}</td>
        </tr>
        {% endfor %}
        </tbody>
      </table>
    </td>
  </tr>
  {% endif %}
{% endfor %}
</table>

<p>
  <small>
    <b>Major</b> is defined by being a tournament where the first place prize money exceeds $2,000. <br/>
    <b>Premier</b> is defined by being an offline tournament where the first place prize money exceeds $10,000 <br/>
    These differ from the definitions used by <a href="http://liquipedia.net">Liquipedia</a>. The reason for this being
    that it's hard use their definition when doing a database lookup as they aren't well-defined.
  </small>
</p>
{% endblock %}
