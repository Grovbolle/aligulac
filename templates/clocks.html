{% extends "index.html" %}

{% comment %}
War clocks
{% endcomment %}

{% load ratings_extras %}

{% block title %}Clocks{% endblock %}

{% block content %}

<script>
// Generated by CoffeeScript 1.7.1
var today, toggle_more;

today = new Date;

toggle_more = function(e) {
  return $(e).next().toggle();
};

$(document).ready(function() {
  return $(".clock").each(function(i, e) {
    var d, days, diff, output, years;
    d = new Date($(e).text());
    diff = Math.floor((today - d) / 1000);
    years = Math.floor(diff / (60 * 60 * 24 * 365));
    diff -= years * (60 * 60 * 24 * 365);
    days = Math.floor(diff / (60 * 60 * 24));
    output = "<div class='clock-number'> " + days + "</div> day" + (days === 1 ? "" : "s");
    if (years > 0) {
      output = ("<div class='clock-number'> " + years + "</div> year" + (years === 1 ? "" : "s")) + output;
    }
    return $(e).html(output);
  });
});
</script>

{% for clock in clocks %}
<div class="clock-block">
  <h3 class="clock-desc">{{ clock.desc }}</h3>
  <div class="clock">{{ clock.date }}</div>
  {% if clock.type == "match" %}
  <div class="clock-block-results">
    <table class="results">
      {% include "matchlist.html" with lm_list=clock.extra.0 lm_adm=0 lm_header="partial" %}
    </table>
    {% if clock.extra.1 %}
    <div class="clock-more-button" onclick="toggle_more(this);">Show More</div>
    <table class="results" style="display: none;">
      {% include "matchlist.html" with lm_list=clock.extra.1 lm_adm=0 lm_header="partial" %}
    </table>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endfor %}

{% endblock %}
